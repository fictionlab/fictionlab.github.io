---
title: ROS API
sidebar_label: ROS API
---

:::warning

The ROS API in the beta version is subject to changes.

:::

## Subscribed topics

- `controller/cmd_ackermann` ([ackermann_msgs/msg/AckermannDrive])

  Steers the robot when operating in the Ackermann steering mode.

- `controller/cmd_turn_in_place` (?) **Not implemented yet**

  Steers the robot when operating in the Turn-In-Place steering mode.

- `controller/cmd_vel` ([geometry_msgs/msg/Twist]) **Not implemented yet**

  Steers the robot using `Twist` commands. More standardized way to control the
  robot. \
  Useful for some navigation stacks. Not recommended for manual teleoperation.

- `controller/led_strip_state` ([rapha_interfaces/msg/LedStripState])

  Sets a new user state for all the LEDs in the LED strip.

- `controller/led_panel_state` ([rapha_interfaces/msg/LedPanelState])

  Sets a new user state for all the LEDs in the specified LED panel.

## Published Topics

- `controller/imu` ([sensor_msgs/msg/Imu])

  Current gyroscope and accelerometer readings from the onboard IMU.

- `controller/odom` ([nav_msgs/msg/Odometry])

  Odometry calculated from wheel encoders and the onboard IMU.

- `controller/steering_mode` ([rapha_interfaces/msg/SteeringMode])

  Current steering mode. Published whenever the mode changes. \
  Uses transient local durability to deliver last message to joining
  subscriptions.

- `controller/diagnostics/imu` ([rapha_interfaces/msg/ImuDiagnostics])

  Diagnostic information about the IMU module. \
  Includes module temperature and calibration data.

- `controller/diagnostics/motors` ([rapha_interfaces/msg/MotorDiagnostics])

  Diagnostic information about the motors. \
  Includes motor temperatures, power consumption and fault data.

- `controller/power_system_state` ([rapha_interfaces/msg/PowerSystemState])

  Current information about the power system.

- `joint_states` ([sensor_msgs/msg/JointState])

  Current state of the robot joints.

- `/rosout` ([rcl_interfaces/msg/Log]) ?

  Logs from all the running ROS nodes.

- `/tf`, `/tf_static` ([tf2_msgs/msg/TFMessage])

  Relationships between TF frames in the ROS network. \
  These topics are used by the
  [tf2 library](https://docs.ros.org/en/jazzy/Concepts/Intermediate/About-Tf2.html).

## Services

- `controller/clear_leds` ([std_srvs/srv/Trigger])

  Resets user states for all LEDs in the LED strip.

- `controller/set_leds` ([rapha_interfaces/srv/SetLeds])

  Set user state for specified LEDs.

- `controller/calibrate_servos` ([std_srvs/srv/Trigger])

  Trigger servo calibration procedure.

- `controller/reset_odom` ([std_srvs/srv/Trigger])

  Reset odometry position.

- `controller/reset_motor_diagnostics` ([std_srvs/srv/Trigger])

  Reset motor faults and calculated consumed energy.

- `controller/set_battery_modes` ([rapha_interfaces/srv/SetBatteryModes])

  Set target battery modes.

- `controller/set_steering_mode` ([rapha_interfaces/srv/SetSteeringMode])

  Set the current steering mode.

## Custom message types

{/* TODO: Remove this section after rapha_interfaces message definitions start being hosted in docs.ros2.org */}

- `rapha_interfaces/msg/SteeringMode`

<a id="msg-steering-mode">

```bash title="Represents the steering mode used by the drivetrain controller."
uint8 ACKERMANN=0
uint8 TURN_IN_PLACE=1

uint8 data
```

</a>

- `rapha_interfaces/msg/BatteryMode`

<a id="msg-battery-mode">

```bash title="Represents the target or actual battery power mode."
bool charging
bool draining
```

</a>

- `rapha_interfaces/msg/BatteryState`

<a id="msg-battery-state">

```bash title="Represents the state of a single battery."
# The current voltage in volts
float64 voltage

# Estimated state of charge in percents

float64 state_of_charge

# The target battery mode

rapha_interfaces/BatteryMode target_mode

# The actual battery mode

rapha_interfaces/BatteryMode current_mode
```

</a>

- `rapha_interfaces/msg/PowerSystemState`

<a id="msg-power-system-state">

```bash title="Represents the state of the Power System."
std_msgs/Header header

# Whether the charger is connected
bool charger_connected

# Whether the batteries are connected
bool bat1_connected
bool bat2_connected

# The states of the batteries, not valid for unconnected batteries
rapha_interfaces/BatteryState bat1_state
rapha_interfaces/BatteryState bat2_state

# The current power output in watts
float64 power

# The energy consumed in watt-hours since the robot was powered on
float64 energy
```

</a>

- `rapha_interfaces/msg/LedColor`

<a id="msg-led-color">

```bash title="Represents the color of an LED."
# The intensity of each color (255 = 100%)
uint8 red
uint8 green
uint8 blue
uint8 white
```

</a>

- `rapha_interfaces/msg/LedPanel`

<a id="msg-led-panel">

```bash title="Enumeration of robot's LED panels."
uint8 FRONT=0
uint8 BACK=1
uint8 LEFT=2
uint8 RIGHT=3

uint8 data
```

</a>

- `rapha_interfaces/msg/LedState`

<a id="msg-led-state">

```bash title="Represents the state of a single LED."
# The duration (in ms) the state should be active.
# Setting it to 0 will make the state active indefinitely.
uint16 duration

# The priority of the state.
# If the value is equal to 0 or is lower than the priority of the current user LED, the state is ignored.
# The value of -1 resets the user state of the LED.
int8 priority

# The color of the LED
rapha_interfaces/LedColor color
```

</a>

- `rapha_interfaces/msg/LedPanelState`

<a id="msg-led-panel-state">

```bash title="Represents the state of the whole LED panel."
rapha_interfaces/LedPanel panel
rapha_interfaces/LedState[36] state
```

</a>

- `rapha_interfaces/msg/LedStripState`

<a id="msg-led-strip-state">

```bash title="Represents the state of the whole LED strip."
uint8 LED_STRIP_SIZE=129
rapha_interfaces/LedState[129] state
```

</a>

- `rapha_interfaces/msg/Led`

<a id="msg-led">

```bash title="Represents the position and the state of the LED."
#
rapha_interfaces/LedPanel panel

# The id of the LED on the panel
uint8 id

#
rapha_interfaces/LedState state
```

</a>

- `rapha_interfaces/msg/MotorDiagnostics`

<a id="msg-motor-diagnostics">

```bash title="Diagnostic information about motors controlled by RaphaCore."
# The order of the motors is:
#   - rear left wheel
#   - rear right wheel
#   - right servo
#   - left servo
#   - front left wheel
#   - front right wheel

std_msgs/Header header

# The current temperature in degrees Celcius
uint8[6] temperature

# The current power output in watts
float64[6] power

# The energy consumed in watt-hours since the robot was powered on
float64[6] energy

uint8 FAULT_BIT_SENSOR_FAULT=1
uint8 FAULT_BIT_BUS_OVERCURRENT=2
uint8 FAULT_BIT_PHASE_OVERCURRENT=4
uint8 FAULT_BIT_STALL=8
uint8 FAULT_BIT_OVERHEAT=16

# The current fault mask reported by the motor
uint8[6] fault_mask_active

# Mask of all fault that occured since the robot was powered on
uint8[6] fault_mask_occured
```

</a>

- `rapha_interfaces/msg/ImuDiagnostics`

<a id="msg-imu-diagnostics">

```bash title="Diagnostic information about IMU sensor running on RaphaCore."
std_msgs/Header header

# The current temperature of the sensor in degrees Celcius
float64 temperature

# The current gyroscope biases
float64 gyro_bias_x
float64 gyro_bias_y
float64 gyro_bias_z
```

</a>

## Custom service types

{/* TODO: Remove this section after rapha_interfaces message definitions start being hosted in docs.ros2.org */}

- `rapha_interfaces/srv/SetSteeringMode`

<a id="srv-set-steering-mode">

```bash
rapha_interfaces/SteeringMode steering_mode
---
bool success
string status_message
```

</a>

- `rapha_interfaces/srv/SetBatteryModes`

<a id="srv-set-battery-modes">

```bash
rapha_interfaces/BatteryMode bat1_mode
rapha_interfaces/BatteryMode bat2_mode
---
bool success
string status_message
```

</a>

- `rapha_interfaces/srv/SetLeds`

<a id="srv-set-leds">

```bash
rapha_interfaces/Led[<=129] leds
---
bool success
string status_message
```

</a>

[ackermann_msgs/msg/AckermannDrive]:
  https://github.com/ros-drivers/ackermann_msgs/blob/ros2/msg/AckermannDrive.msg
[geometry_msgs/msg/Twist]:
  https://docs.ros2.org/latest/api/geometry_msgs/msg/Twist.html
[nav_msgs/msg/Odometry]:
  https://docs.ros2.org/latest/api/nav_msgs/msg/Odometry.html
[rcl_interfaces/msg/Log]:
  https://docs.ros2.org/latest/api/rcl_interfaces/msg/Log.html
[sensor_msgs/msg/JointState]:
  https://docs.ros2.org/latest/api/sensor_msgs/msg/JointState.html
[sensor_msgs/msg/Imu]: https://docs.ros2.org/latest/api/sensor_msgs/msg/Imu.html
[std_srvs/srv/Trigger]:
  https://docs.ros2.org/latest/api/std_srvs/srv/Trigger.html
[tf2_msgs/msg/TFMessage]:
  https://docs.ros2.org/latest/api/tf2_msgs/msg/TFMessage.html
[rapha_interfaces/msg/BatteryMode]: #msg-battery-mode
[rapha_interfaces/msg/BatteryState]: #msg-battery-state
[rapha_interfaces/msg/ImuDiagnostics]: #msg-imu-diagnostics
[rapha_interfaces/msg/Led]: #msg-led
[rapha_interfaces/msg/LedColor]: #msg-led-color
[rapha_interfaces/msg/LedPanel]: #msg-led-panel
[rapha_interfaces/msg/LedPanelState]: #msg-led-panel-state
[rapha_interfaces/msg/LedState]: #msg-led-state
[rapha_interfaces/msg/LedStripState]: #msg-led-strip-state
[rapha_interfaces/msg/MotorDiagnostics]: #msg-motor-diagnostics
[rapha_interfaces/msg/PowerSystemState]: #msg-power-system-state
[rapha_interfaces/msg/SteeringMode]: #msg-steering-mode
[rapha_interfaces/srv/SetBatteryModes]: #srv-set-battery-modes
[rapha_interfaces/srv/SetLeds]: #srv-set-leds
[rapha_interfaces/srv/SetSteeringMode]: #srv-set-steering-mode
